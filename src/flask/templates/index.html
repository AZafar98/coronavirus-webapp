{% extends 'base.html' %}

{%block head %}
    {{ super() }}
    <meta property="og:title" content="COVID-19 Live"/>
    <meta property="og:url" content="https://azafar98.pythonanywhere.com/"/>
    <meta property="og:description" content="View and compare worldwide COVID-19 data by country. Contrast COVID-19 data
     with other societal issues in the UK."/>
{% endblock %}

{%block title %} COVID-19 Live {% endblock %}

{%block scripts %}
    <script type="text/javascript" defer>

            let totalCases = {{ displayCovidCases(cases=True, period='Total') }};
            let totalCasesDate = {{ displayCovidCases(cases=False, period='Total') |tojson|safe }};
            let cases24H = {{ displayCovidCases(cases=True, period='24h') }};
            let cases24HDate = {{ displayCovidCases(cases=False, period='24h') |tojson|safe }};
            let cases7Days = {{ displayCovidCases(cases=True, period='7days') }};
            let cases7DaysDate = {{ displayCovidCases(cases=False, period='7days') |tojson|safe }};
            let heartDiseaseData = {{ getPHEData(indicator=273, differenced=True, dev=True) }}
            let depressionData = {{ getPHEData(indicator=848, differenced=True, dev=True) }}
            let domesticAbuseData = {{ getPHEData(indicator=92863, differenced=False, dev=True) }}
            let confirmedCovidTimeSeries = {{ getCovidTimeSeries(data_type='confirmed', difference=False, country=None) |tojson|safe }}
            let deathCovidTimeSeries = {{ getCovidTimeSeries(data_type='deaths', difference=False, country=None) |tojson|safe }}
            let recoveredCovidTimeSeries = {{ getCovidTimeSeries(data_type='recovered', difference=False, country=None) |tojson|safe }}
            let confirmedCovidTimeSeriesDiff = {{ getCovidTimeSeries(data_type='confirmed', difference=True, country=None) |tojson|safe }}
            let deathCovidTimeSeriesDiff = {{ getCovidTimeSeries(data_type='deaths', difference=True, country=None) |tojson|safe }}
            let recoveredCovidTimeSeriesDiff = {{ getCovidTimeSeries(data_type='recovered', difference=True, country=None) |tojson|safe }}
        </script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/index.js') }}" defer></script>
{% endblock %}

{% block content %}

<div class="container-fluid text-center align-items-center">

    <div class="row content text-center align-items-center mt-5">
        <div class="col" id="covidCount">
            <h1 id="covidNumberTitle">
                <span id="covidNumber"></span>
                <small id="covidCountStrapline">United Kingdom COVID-19 cases</small>
                <span id="dataDate"></span>
            </h1>
        </div>
    </div>


    <div class="row content text-center align-items-center">
        <div class="col align-items-center text-center">
            <button type="button" class="btn btn-primary timeRangeButton" id="timeRangeButton1">
                Total
            </button>
            <button type="button" class="btn btn-primary timeRangeButton" id="timeRangeButton2">
                7 Days
            </button>
            <button type="button" class="btn btn-primary timeRangeButton" id="timeRangeButton3">
                24 Hours
            </button>
        </div>
    </div>

    <div class="row content text-left">
        <div class="col mt-5">
            <span class="mx-1" id="otherSubtitle">Trajectory</span>

            <div class="accordion mx-3 mt-2" id="trajectory-explainer-accordian">
                <div class="card">
                    <div class="card-header accordion-heading">
                        <h2 class="mb-0">
                            <button class="btn btn-link collapsed" type="button" data-toggle="collapse"
                                    data-target="#trajectory-explainer"
                                    aria-expanded="false" aria-controls="trajectory-explainer"
                                    id="explainer-header-text">
                                <i class="fa" aria-hidden="true"></i>
                                What does this mean?
                            </button>
                        </h2>
                    </div>

                    <div id="trajectory-explainer" class="collapse" aria-labelledby="trajectory-explain-heading"
                         data-parent="#trajectory-explainer-accordian">
                        <div class="card-body">
                            <p class="card-para">
                                Explore how cases, deaths and recoveries related to COVID-19 have grown across the world.
                            </p>
                            <p class="card-para">
                                First choose the type of data you want to see, and then select all of the countries you
                                would like to graph the data for. Note that the dropdown menu for countries is searchable.
                            </p>
                            <p class="card-para">
                                All of the COVID-19 data is sourced from the <a
                                    href="https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data">
                                John Hopkins University and Medicine Github Repository.
                            </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row my-3 mx-2" id="graph-select-menus">
        <div class="col-sm-4">
            <i class="fa fa-question-circle" data-toggle="tooltip" title="<b>Total:</b> Total cases reported at the
             end of each day <br>
              <b>New reports per day:</b> Number of new cases, deaths of recoveries each day."></i>
            <div class="form-group">
                <select data-style="bg-white px-4 py-3 shadow-sm" class="selectpicker form-control show-tick"
                        title="Type of data" id="dataFreqSelect">
                    <option value="total" selected>Total</option>
                    <option value="new">New reports per day</option>
                </select>
            </div>
        </div>

        <div class="col-sm-4">
            <i class="fa fa-question-circle" data-toggle="tooltip" title="Category of data to view. <br> For definitions
             of the data types, see the <a href='{{ url_for('about') }}'> about page</a>"></i>
            <div class="form-group">
                <select data-style="bg-white px-4 py-3 shadow-sm" class="selectpicker form-control show-tick"
                        title="Data to view" id="covidTypeSelect">
                    <option value="confirmed" selected>Confirmed cases</option>
                    <option value="deaths">Deaths</option>
                    <option value="recovered">Recovered cases</option>
                </select>
            </div>
        </div>

        <div class="col-sm-4">
            <i class="fa fa-question-circle" data-toggle="tooltip" title="Select countries to graph and compare.<br>
            Note that the menu is searchable."></i>
            <div class="form-group">
                <select data-style="bg-white px-4 py-3 shadow-sm" class="selectpicker form-control show-tick"
                        multiple data-live-search="true" data-selected-text-format="count > 3"
                        data-count-selected-text= "{0} countries selected" title="Countries to compare"
                        data-actions-box="true" id="countrySelector">
                    {% for country in country_options %}
                    <option value="{{ country }}">{{ country }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </div>

    <div class="row mx-1">
        <div class="col-sm-9" id="covid-graph-container">
            <div class="col mt-3 w-100" id="covidTimeSeries"></div>
        </div>
        <div class="col-sm-2" id="covidLegend"></div>
    </div>

    <div class="row content text-left">
        <div class="col mt-5">
            <span class="mx-1" id="otherSubtitle">How does this compare?</span>

            <div class="accordion mx-3 mt-2" id="graph-explainer">
                <div class="card">
                    <div class="card-header accordion-heading">
                        <h2 class="mb-0">
                            <button class="btn btn-link" type="button" data-toggle="collapse"
                                    data-target="#graph-interpret"
                                    aria-expanded="false" aria-controls="graph-interpret" id="explainer-header-text">
                                <i class="fa" aria-hidden="true"></i>
                                 Understanding the graph
                            </button>
                        </h2>
                    </div>

                    <div id="graph-interpret" class="collapse show" aria-labelledby="graph-explain-heading"
                         data-parent="#graph-explainer">
                        <div class="card-body">
                            <p class="card-para">
                                The graph shows the reported number of COVID-19 cases compared to the average rate of
                                occurrence
                                of (so far) heart disease, depression and domestic abuse.
                                <br>
                                For more information about the data, see <a href="{{ url_for('about') }}">here.</a>
                            </p>
                            <p class="card-para">
                                The intention is not to take away from the seriousness of the threat COVID-19 poses to
                                us,
                                but to share some perspective about some of the other important issues we face as a
                                society in the context of COVID-19.
                            </p>
                            <p class="card-para">
                                The data below is from <abbr title="Public Health England" class="initialism">PHE</abbr>.
                                Yearly figures have been averaged to 7 days and 24 hours to give an
                                average representation where the exact data is not available.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row content text-left">
        <div class="col mx-auto" id="graph-container">
            <canvas class="col mt-5 w-75" id="graphArea"></canvas>
        </div>
    </div>
</div>

{% endblock %}
